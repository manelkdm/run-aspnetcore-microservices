{
  "annotations": {"list": [{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "links": [],
  "liveNow": false,
  "panels": [
    {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0}, "id": 1, "panels": [], "title": "Traffic & Errors", "type": "row"},
    {
      "type": "timeseries",
      "title": "Log lines by level",
      "id": 2,
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 1},
      "targets": [
        {"datasource": {"type": "loki", "uid": "loki"}, "refId": "A", "expr": "sum by (level) (count_over_time({job=~\"$job\",service_name=~\"$service\"}[$__interval]))"}
      ],
      "fieldConfig": {"defaults": {"custom": {"drawStyle": "line"}}, "overrides": []}
    },
    {
      "type": "timeseries",
      "title": "Requests per second by status code",
      "id": 3,
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 1},
      "targets": [
        {"datasource": {"type": "loki", "uid": "loki"}, "refId": "A", "expr": "sum by (http_status_code) (count_over_time({job=~\"$job\",service_name=~\"$service\",http_status_code!=\"\"}[$__interval]))"}
      ],
      "fieldConfig": {"defaults": {"unit": "reqps"}, "overrides": []}
    },
    {
      "type": "stat",
      "title": "Error rate (5xx %)",
      "id": 4,
      "gridPos": {"h": 6, "w": 6, "x": 0, "y": 9},
      "targets": [
        {"refId":"A","datasource":{"type":"loki","uid":"loki"},"expr":"sum(rate({job=~\"$job\",service_name=~\"$service\",http_status_code=~\"5..\"}[1m]))"},
        {"refId":"B","datasource":{"type":"loki","uid":"loki"},"expr":"sum(rate({job=~\"$job\",service_name=~\"$service\",http_status_code!=\\\"\\\"}[1m]))"},
        {"refId":"C","datasource":{"type":"grafana","uid":"grafana"},"expression":"100 * $A / clamp_min($B, 1)","hide":false}
      ],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "orientation": "auto", "textMode": "auto", "colorMode": "value", "graphMode": "none", "justifyMode": "auto"},
      "fieldConfig": {"defaults": {"unit": "percent", "decimals": 2}, "overrides": []}
    },
    {
      "type": "bargauge",
      "title": "Top routes by traffic",
      "id": 5,
      "gridPos": {"h": 6, "w": 9, "x": 6, "y": 9},
      "targets": [
        {"datasource":{"type":"loki","uid":"loki"},"refId":"A","expr":"topk(10, sum by (http_route) (count_over_time({job=~\"$job\",service_name=~\"$service\",http_route!=\"\"}[$__range])))"}
      ]
    },
    {
      "type": "timeseries",
      "title": "HTTP request rates",
      "id": 6,
      "gridPos": {"h": 6, "w": 9, "x": 15, "y": 9},
      "targets": [
        {"datasource":{"type":"loki","uid":"loki"},"refId":"A","expr":"sum by (http_method, http_route, http_status_code) (rate({job=~\"$job\",service_name=~\"$service\",http_status_code!=\"\"}[1m]))"}
      ],
      "fieldConfig": {"defaults": {"unit": "reqps"}, "overrides": []}
    },
    {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 15}, "id": 7, "panels": [], "title": "Logs", "type": "row"},
    {
      "type": "logs",
      "title": "Recent errors",
      "id": 8,
      "gridPos": {"h": 10, "w": 24, "x": 0, "y": 16},
      "options": {"showLabels": true, "showTime": true, "wrapLogMessage": true},
      "targets": [
        {"datasource":{"type":"loki","uid":"loki"},"refId":"A","expr":"{job=~\"$job\",service_name=~\"$service\",level=~\"ERROR|WARN\"} | json"}
      ]
    },
    {
      "type": "timeseries",
      "title": "Response time p95 (ms)",
      "id": 9,
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 26},
      "targets": [
        {"datasource": {"type": "loki", "uid": "loki"}, "refId": "A", "expr": "quantile_over_time(0.95, ({job=~\"$job\",service_name=~\"$service\"} | json | label_format elapsed=\"{{.attributes.ElapsedMilliseconds}}\" | unwrap elapsed)[$__interval])"}
      ],
      "fieldConfig": {"defaults": {"unit": "ms"}, "overrides": []}
    },
    {
      "type": "logs",
      "title": "Recent logs",
      "id": 10,
      "gridPos": {"h": 10, "w": 24, "x": 0, "y": 34},
      "options": {"showLabels": true, "showTime": true, "wrapLogMessage": true},
      "targets": [
        {"datasource":{"type":"loki","uid":"loki"},"refId":"A","expr":"{job=~\"$job\",service_name=~\"$service\"} | json"}
      ]
    }
    ,
    {
      "type": "table",
      "title": "Traces (Jaeger)",
      "id": 11,
      "gridPos": {"h": 12, "w": 24, "x": 0, "y": 44},
      "options": {"showHeader": true},
      "fieldConfig": {
        "defaults": {"custom": {}},
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "Trace ID"},
            "properties": [
              {"id": "links", "value": [{"title": "Open in Jaeger", "url": "http://localhost:16686/trace/${__value.raw}", "targetBlank": true}]}
            ]
          }
        ]
      },
      "targets": [
        {"datasource": {"type": "jaeger", "uid": "jaeger"}, "refId": "A", "queryType": "search", "service": "${service:single}", "operation": "", "tags": "", "minDuration": "", "limit": 20, "lookback": "1h"}
      ]
    }
  ],
  "refresh": "10s",
  "schemaVersion": 39,
  "tags": ["otel","loki","logs"],
  "templating": {
    "list": [
      {"name": "job", "label": "Job", "type": "query", "datasource": {"type":"loki","uid":"loki"}, "query": "label_values(job)", "refresh": 1, "includeAll": true, "multi": true, "sort": 1, "allValue": ".+", "current": {"text": "All", "value": [".+"]}},
      {"name": "service", "label": "Service", "type": "query", "datasource": {"type":"loki","uid":"loki"}, "query": "label_values({job=~\"$job\"}, service_name)", "refresh": 1, "includeAll": true, "multi": true, "sort": 1, "allValue": ".+", "current": {"text": "All", "value": [".+"]}}
    ]
  },
  "time": {"from": "now-1h", "to": "now"},
  "timepicker": {},
  "timezone": "",
  "title": "OTel Logs",
  "uid": "otel-logs-advanced",
  "version": 1,
  "weekStart": ""
}






