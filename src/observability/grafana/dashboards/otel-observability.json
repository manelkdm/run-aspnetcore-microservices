{
  "annotations": {"list": [{"builtIn": 1, "datasource": {"type": "grafana", "uid": "-- Grafana --"}, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard"}]},
  "editable": true,
  "graphTooltip": 0,
  "refresh": "10s",
  "panels": [
    {"type": "row", "title": "Golden Signals", "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0}},
    {"type": "timeseries", "title": "Traffic (RPS) by service", "gridPos": {"h": 8, "w": 12, "x": 0, "y": 1},
      "datasource": {"type": "prometheus", "uid": "prom"},
      "targets": [{"refId": "A", "expr": "sum by (service_name) (rate(http_server_request_duration_seconds_count[$__rate_interval]))", "range": true }]},
    {"type": "timeseries", "title": "Latency p95 (ms) by service", "gridPos": {"h": 8, "w": 12, "x": 12, "y": 1},
      "datasource": {"type": "prometheus", "uid": "prom"}, "fieldConfig": {"defaults": {"unit": "ms"}},
      "targets": [{"refId": "A", "expr": "1000 * histogram_quantile(0.95, sum by (service_name, le) (rate(http_server_request_duration_seconds_bucket[5m])))", "range": true }]},
    {"type": "timeseries", "title": "Errors (5xx %) by service", "gridPos": {"h": 8, "w": 12, "x": 0, "y": 9},
      "datasource": {"type": "prometheus", "uid": "prom"}, "fieldConfig": {"defaults": {"unit": "percent", "decimals": 2}},
      "targets": [{"refId": "A", "expr": "100 * sum by (service_name) (rate(http_server_request_duration_seconds_count{http_response_status_code=~\"5..\"}[$__rate_interval])) / clamp_min(sum by (service_name) (rate(http_server_request_duration_seconds_count[$__rate_interval])), 1)", "range": true }]},
    {"type": "timeseries", "title": "Saturation (Managed heap MB) by service", "gridPos": {"h": 8, "w": 12, "x": 12, "y": 9},
      "datasource": {"type": "prometheus", "uid": "prom"}, "fieldConfig": {"defaults": {"unit": "megabytes"}},
      "targets": [{"refId": "A", "expr": "sum by (service_name) (process_runtime_dotnet_gc_heap_size_bytes) / 1024 / 1024", "range": true }]},

    {"type": "row", "title": "Availability", "gridPos": {"h": 1, "w": 24, "x": 0, "y": 17}},
    {"type": "stat", "title": "Active services (count)", "gridPos": {"h": 4, "w": 6, "x": 0, "y": 18},
      "datasource": {"type": "prometheus", "uid": "prom"},
      "targets": [{"refId": "A", "expr": "count(sum by (service_name) (rate(http_server_request_duration_seconds_count[5m])) > 0)"}],
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "values": false, "fields": ""}}},
    {"type": "table", "title": "Active services (last 5m)", "gridPos": {"h": 6, "w": 9, "x": 6, "y": 18},
      "datasource": {"type": "prometheus", "uid": "prom"},
      "targets": [{"refId": "A", "expr": "sum by (service_name) (rate(http_server_request_duration_seconds_count[5m])) > 0"}]},
    {"type": "table", "title": "Services down/idle (last 5m)", "gridPos": {"h": 6, "w": 9, "x": 15, "y": 18},
      "datasource": {"type": "prometheus", "uid": "prom"},
      "targets": [{"refId": "A", "expr": "(sum by (service_name) (process_runtime_dotnet_gc_heap_size_bytes) > 0) unless (sum by (service_name) (rate(http_server_request_duration_seconds_count[5m])) > 0)"}]},
    {"type": "stat", "title": "RPS (overall)", "gridPos": {"h": 4, "w": 6, "x": 0, "y": 24},
      "datasource": {"type": "prometheus", "uid": "prom"}, "fieldConfig": {"defaults": {"decimals": 2}},
      "targets": [{"refId": "A", "expr": "sum(rate(http_server_request_duration_seconds_count[$__rate_interval]))"}]},

    {"type": "row", "title": "Logs & Traces", "gridPos": {"h": 1, "w": 24, "x": 0, "y": 28}},
    {"type": "logs", "title": "Recent logs (formatted)", "gridPos": {"h": 10, "w": 24, "x": 0, "y": 29},
      "datasource": {"type": "loki", "uid": "loki"},
      "options": {"showLabels": true, "showTime": true, "wrapLogMessage": true},
      "targets": [{"refId": "A", "expr": "{service_name=~\"$service\"} | json | line_format \"{{ .severity }} [{{ index . \\\"service.name\\\" }}] {{ index . \\\"http.method\\\" }} {{ index . \\\"http.route\\\" }} -> {{ index . \\\"http.status_code\\\" }} | {{ .body }}\""}]},
    {"type": "table", "title": "Recent traces (click Trace ID)", "gridPos": {"h": 8, "w": 24, "x": 0, "y": 39},
      "datasource": {"type": "loki", "uid": "loki"},
      "fieldConfig": {"defaults": {}, "overrides": [{"matcher": {"id": "byName", "options": "Line"}, "properties": [{"id": "links", "value": [{"title": "Open in Jaeger", "url": "http://localhost:16686/trace/${__value.raw}", "targetBlank": true}]}]}]},
      "targets": [{"refId": "A", "expr": "{service_name=~\"$service\"} | json | line_format \"{{.traceid}}\""}]}
    ,
    {"type": "row", "title": "Service Health", "gridPos": {"h": 1, "w": 24, "x": 0, "y": 47}},
    {"type": "stat", "title": "Gateway", "gridPos": {"h": 4, "w": 6, "x": 0, "y": 48},
      "datasource": {"type": "prometheus", "uid": "prom"},
      "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"0": {"color": "red", "index": 0, "text": "DOWN"}, "1": {"color": "green", "index": 1, "text": "UP"}}}]}, "overrides": []},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "values": false, "fields": ""}},
      "targets": [{"refId": "A", "expr": "max_over_time(probe_success{job=\"blackbox\",instance=\"http://yarpapigateway:8080/health\"}[1m])"}]},
    {"type": "stat", "title": "Basket API", "gridPos": {"h": 4, "w": 6, "x": 6, "y": 48},
      "datasource": {"type": "prometheus", "uid": "prom"},
      "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"0": {"color": "red", "index": 0, "text": "DOWN"}, "1": {"color": "green", "index": 1, "text": "UP"}}}]}, "overrides": []},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "values": false, "fields": ""}},
      "targets": [{"refId": "A", "expr": "max_over_time(probe_success{job=\"blackbox\",instance=\"http://basket.api:8080/health\"}[1m])"}]},
    {"type": "stat", "title": "Catalog API", "gridPos": {"h": 4, "w": 6, "x": 12, "y": 48},
      "datasource": {"type": "prometheus", "uid": "prom"},
      "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"0": {"color": "red", "index": 0, "text": "DOWN"}, "1": {"color": "green", "index": 1, "text": "UP"}}}]}, "overrides": []},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "values": false, "fields": ""}},
      "targets": [{"refId": "A", "expr": "max_over_time(probe_success{job=\"blackbox\",instance=\"http://catalog.api:8080/health\"}[1m])"}]},
    {"type": "stat", "title": "Ordering API", "gridPos": {"h": 4, "w": 6, "x": 18, "y": 48},
      "datasource": {"type": "prometheus", "uid": "prom"},
      "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"0": {"color": "red", "index": 0, "text": "DOWN"}, "1": {"color": "green", "index": 1, "text": "UP"}}}]}, "overrides": []},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "values": false, "fields": ""}},
      "targets": [{"refId": "A", "expr": "max_over_time(probe_success{job=\"blackbox\",instance=\"http://ordering.api:8080/health\"}[1m])"}]}
  ],
  "schemaVersion": 39,
  "templating": {"list": [{"name": "service", "label": "Service", "type": "query", "datasource": {"type": "prometheus", "uid": "prom"}, "query": "label_values(http_server_request_duration_seconds_count, service_name)", "refresh": 1, "includeAll": true, "multi": false, "allValue": ".+"}]},
  "time": {"from": "now-1h", "to": "now"},
  "timezone": "",
  "title": "OTel Observability (Combined)",
  "uid": "otel-observability",
  "version": 1
}

